# ‚úÖ CHECKLIST DE IMPLEMENTACI√ìN - Sistema de Vacaciones

## üìã Gu√≠a Paso a Paso para Activar el Sistema

---

## FASE 1: PREPARACI√ìN DE BASE DE DATOS

### ‚¨ú 1.1 Abrir Supabase Dashboard
- [ ] Ir a https://app.supabase.com
- [ ] Seleccionar tu proyecto
- [ ] Verificar que est√°s en el proyecto correcto

### ‚¨ú 1.2 Abrir SQL Editor
- [ ] En el men√∫ lateral, hacer clic en "SQL Editor"
- [ ] Crear un nuevo query

### ‚¨ú 1.3 Ejecutar Script SQL
- [ ] Abrir archivo: `supabase-vacations-schema.sql`
- [ ] Copiar TODO el contenido del archivo
- [ ] Pegar en el SQL Editor de Supabase
- [ ] Hacer clic en el bot√≥n "Run" (‚ñ∂Ô∏è)
- [ ] Esperar a que termine la ejecuci√≥n (10-15 segundos)

### ‚¨ú 1.4 Verificar Creaci√≥n de Tablas
```sql
-- Ejecutar este query en SQL Editor
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name LIKE 'vacation%';
```

**Resultado esperado:**
```
vacation_requests
vacation_cycles
```

### ‚¨ú 1.5 Verificar Estructura de vacation_requests
```sql
-- Ejecutar este query
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'vacation_requests'
ORDER BY ordinal_position;
```

**Debe mostrar:**
- id (uuid)
- employee_id (uuid)
- office_id (uuid)
- start_date (date)
- end_date (date)
- days_requested (integer)
- status (text)
- reason (text)
- approved_by (text)
- approved_at (timestamp with time zone)
- rejected_reason (text)
- created_at (timestamp with time zone)
- updated_at (timestamp with time zone)

### ‚¨ú 1.6 Verificar Estructura de vacation_cycles
```sql
-- Ejecutar este query
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'vacation_cycles'
ORDER BY ordinal_position;
```

**Debe mostrar:**
- id (uuid)
- employee_id (uuid)
- cycle_start_date (date)
- cycle_end_date (date)
- days_earned (integer)
- days_used (integer)
- days_available (integer)
- years_of_service (integer)
- is_expired (boolean)
- created_at (timestamp with time zone)
- updated_at (timestamp with time zone)

### ‚¨ú 1.7 Verificar √çndices
```sql
-- Ejecutar este query
SELECT indexname 
FROM pg_indexes 
WHERE tablename IN ('vacation_requests', 'vacation_cycles');
```

**Debe incluir:**
- idx_vacation_requests_employee
- idx_vacation_requests_office
- idx_vacation_requests_status
- idx_vacation_requests_dates
- idx_vacation_cycles_employee
- idx_vacation_cycles_dates
- idx_vacation_cycles_expired

### ‚¨ú 1.8 Verificar Triggers
```sql
-- Ejecutar este query
SELECT trigger_name, event_manipulation, event_object_table 
FROM information_schema.triggers 
WHERE event_object_table IN ('vacation_requests', 'vacation_cycles');
```

**Debe incluir:**
- trigger_vacation_requests_updated_at
- trigger_vacation_cycles_updated_at
- trigger_check_vacation_cycle_expiration

### ‚¨ú 1.9 Verificar Vista
```sql
-- Ejecutar este query
SELECT * FROM vacation_summary LIMIT 5;
```

**Debe ejecutarse sin errores** (puede estar vac√≠a si no hay empleados)

### ‚¨ú 1.10 Verificar Funci√≥n SQL
```sql
-- Probar la funci√≥n
SELECT get_vacation_days_by_years(1) as year_1,
       get_vacation_days_by_years(5) as year_5,
       get_vacation_days_by_years(8) as year_8,
       get_vacation_days_by_years(15) as year_15,
       get_vacation_days_by_years(35) as year_35;
```

**Resultado esperado:**
```
year_1: 12
year_5: 20
year_8: 22
year_15: 24
year_35: 32
```

---

## ‚úÖ FASE 1 COMPLETADA
**Si todos los checks anteriores pasaron, la base de datos est√° lista.**

---

## FASE 2: VERIFICACI√ìN DEL C√ìDIGO

### ‚¨ú 2.1 Verificar Archivo Backend
- [ ] Abrir: `lib/supabase/db-functions.ts`
- [ ] Buscar: `export interface VacationRequest`
- [ ] Buscar: `export interface VacationCycle`
- [ ] Buscar: `export async function getVacationRequests`
- [ ] Buscar: `export async function createVacationRequest`
- [ ] Buscar: `export function calculateVacationDays`

**‚úÖ Todo encontrado = Backend OK**

### ‚¨ú 2.2 Verificar Archivo Frontend
- [ ] Abrir: `app/oficina/[officeId]/vacaciones/page.tsx`
- [ ] Buscar: `showDiasPorLey`
- [ ] Buscar: `showNewRequest`
- [ ] Buscar: `VACATION_DAYS_BY_LAW`
- [ ] Buscar: `handleCreateRequest`

**‚úÖ Todo encontrado = Frontend OK**

### ‚¨ú 2.3 Verificar Imports en Frontend
```typescript
// Deben estar presentes:
import { getVacationRequests } from "@/lib/supabase/db-functions"
import { createVacationRequest } from "@/lib/supabase/db-functions"
import { calculateVacationDays } from "@/lib/supabase/db-functions"
import { calculateYearsOfService } from "@/lib/supabase/db-functions"
```

**‚úÖ Todos presentes = Imports OK**

---

## ‚úÖ FASE 2 COMPLETADA
**El c√≥digo est√° en su lugar y correctamente estructurado.**

---

## FASE 3: PRUEBAS FUNCIONALES

### ‚¨ú 3.1 Iniciar Servidor de Desarrollo
```bash
# En la terminal, ejecutar:
npm run dev
# o
pnpm dev
# o
yarn dev
```

- [ ] Servidor inicia sin errores
- [ ] Ver mensaje: "Ready in X ms"
- [ ] URL disponible: http://localhost:3000

### ‚¨ú 3.2 Navegar a P√°gina de Vacaciones
- [ ] Abrir navegador
- [ ] Ir a: `http://localhost:3000/oficina/[tu-codigo]/vacaciones`
  - Ejemplo: `http://localhost:3000/oficina/cdmx/vacaciones`
- [ ] La p√°gina carga correctamente
- [ ] No hay errores en consola del navegador (F12)

### ‚¨ú 3.3 Verificar Elementos de UI
- [ ] Se ven 4 tarjetas de estad√≠sticas (Pendientes, Aprobadas, En Curso, Completadas)
- [ ] Se ve el campo de b√∫squeda
- [ ] Se ven los botones: "D√≠as por Ley", "Filtros", "Exportar", "Nueva Solicitud"
- [ ] Se ve la tabla de solicitudes (puede estar vac√≠a)

### ‚¨ú 3.4 Probar Bot√≥n "D√≠as por Ley"
- [ ] Hacer clic en "D√≠as por Ley"
- [ ] Se abre un modal
- [ ] El modal tiene t√≠tulo: "D√≠as de Vacaciones por Ley"
- [ ] Se ve la tabla con a√±os y d√≠as:
  - 1 a√±o ‚Üí 12 d√≠as
  - 2 a√±os ‚Üí 14 d√≠as
  - 3 a√±os ‚Üí 16 d√≠as
  - 4 a√±os ‚Üí 18 d√≠as
  - 5 a√±os ‚Üí 20 d√≠as
  - 6-10 a√±os ‚Üí 22 d√≠as
  - 11-15 a√±os ‚Üí 24 d√≠as
  - 16-20 a√±os ‚Üí 26 d√≠as
  - 21-25 a√±os ‚Üí 28 d√≠as
  - 26-30 a√±os ‚Üí 30 d√≠as
  - 31-35 a√±os ‚Üí 32 d√≠as
- [ ] Se ve el mensaje: "Los d√≠as de vacaciones est√°n vigentes por 1 a√±o y 6 meses..."
- [ ] El bot√≥n "Cerrar" funciona

### ‚¨ú 3.5 Probar Bot√≥n "Nueva Solicitud"
- [ ] Hacer clic en "Nueva Solicitud"
- [ ] Se abre un modal
- [ ] El modal tiene t√≠tulo: "Nueva Solicitud de Vacaciones"
- [ ] Se ven los campos:
  - Dropdown "Empleado" con asterisco rojo (*)
  - Input "Fecha de inicio" con asterisco rojo (*)
  - Input "Fecha de fin" con asterisco rojo (*)
  - Textarea "Motivo (opcional)"
- [ ] Botones "Cancelar" y "Crear Solicitud" presentes

### ‚¨ú 3.6 Probar Dropdown de Empleados
- [ ] Hacer clic en dropdown "Empleado"
- [ ] Se abre la lista de empleados
- [ ] Cada empleado muestra:
  - Nombre
  - A√±os de servicio
  - D√≠as por a√±o
  - Ejemplo: "Juan P√©rez | 3 a√±os de servicio ‚Ä¢ 16 d√≠as por a√±o"
- [ ] Seleccionar un empleado funciona

**Si no hay empleados:**
- [ ] Debe mostrar: "No hay empleados disponibles"
- [ ] Ir a la secci√≥n de Empleados y crear al menos uno

### ‚¨ú 3.7 Probar Selecci√≥n de Fechas
- [ ] Seleccionar fecha de inicio
- [ ] El campo se llena correctamente
- [ ] Seleccionar fecha de fin
- [ ] El campo se llena correctamente
- [ ] Aparece mensaje: "D√≠as solicitados: X"
- [ ] El n√∫mero de d√≠as es correcto (fin - inicio + 1)

### ‚¨ú 3.8 Probar Validaciones
#### Test A: Campos vac√≠os
- [ ] Dejar campos vac√≠os
- [ ] Hacer clic en "Crear Solicitud"
- [ ] Aparece toast rojo: "Campos incompletos"

#### Test B: Fecha inv√°lida
- [ ] Seleccionar fecha inicio: 2024-01-20
- [ ] Seleccionar fecha fin: 2024-01-15 (anterior)
- [ ] Hacer clic en "Crear Solicitud"
- [ ] Aparece toast rojo: "Fechas inv√°lidas"

### ‚¨ú 3.9 Crear Solicitud de Prueba
- [ ] Llenar formulario completo:
  - Empleado: Seleccionar uno
  - Fecha inicio: Fecha v√°lida
  - Fecha fin: Fecha v√°lida (posterior al inicio)
  - Motivo: "Prueba del sistema"
- [ ] Hacer clic en "Crear Solicitud"
- [ ] Aparece toast verde: "Solicitud de X d√≠as creada exitosamente"
- [ ] El modal se cierra autom√°ticamente
- [ ] La nueva solicitud aparece en la tabla
- [ ] Los campos del formulario se limpian

### ‚¨ú 3.10 Verificar Solicitud Creada
- [ ] En la tabla, localizar la solicitud reci√©n creada
- [ ] Verificar que muestra:
  - Nombre del empleado
  - Avatar con iniciales
  - A√±os de servicio y d√≠as por a√±o
  - Fechas formateadas correctamente
  - Badge con d√≠as solicitados
  - Badge amarillo "Pendiente"
  - Botones "Ver", "Aprobar", "Rechazar"

### ‚¨ú 3.11 Verificar Estad√≠sticas
- [ ] Tarjeta "Pendientes" muestra: 1
- [ ] Tarjeta "Aprobadas" muestra: 0
- [ ] Tarjeta "En Curso" muestra: 0
- [ ] Tarjeta "Completadas" muestra: 0

### ‚¨ú 3.12 Probar B√∫squeda
- [ ] Escribir nombre del empleado en buscador
- [ ] La tabla filtra mostrando solo esa solicitud
- [ ] Borrar b√∫squeda
- [ ] La tabla muestra todas las solicitudes nuevamente

### ‚¨ú 3.13 Probar Bot√≥n "Ver"
- [ ] Hacer clic en bot√≥n "Ver"
- [ ] (Actualmente solo es visual, funcionalidad futura)

### ‚¨ú 3.14 Probar Bot√≥n "Aprobar"
- [ ] Hacer clic en bot√≥n "Aprobar"
- [ ] El badge cambia de "Pendiente" a "Aprobada"
- [ ] El color cambia de amarillo a verde
- [ ] Los botones "Aprobar" y "Rechazar" desaparecen
- [ ] Estad√≠sticas actualizan: Pendientes -1, Aprobadas +1

### ‚¨ú 3.15 Crear Otra Solicitud y Rechazar
- [ ] Crear una segunda solicitud
- [ ] Hacer clic en "Rechazar"
- [ ] El badge cambia a "Rechazada" (rojo)
- [ ] Los botones desaparecen
- [ ] Estad√≠sticas actualizan

---

## ‚úÖ FASE 3 COMPLETADA
**Todas las funcionalidades principales est√°n operando correctamente.**

---

## FASE 4: VERIFICACI√ìN EN BASE DE DATOS

### ‚¨ú 4.1 Verificar Datos en vacation_requests
```sql
-- En Supabase SQL Editor
SELECT 
  vr.*,
  e.name as employee_name
FROM vacation_requests vr
JOIN employees e ON vr.employee_id = e.id
ORDER BY vr.created_at DESC
LIMIT 10;
```

**Verificar:**
- [ ] Aparecen las solicitudes creadas en las pruebas
- [ ] Los datos son correctos (fechas, d√≠as, status)
- [ ] created_at tiene timestamp v√°lido
- [ ] approved_at se llena cuando status = 'approved'

### ‚¨ú 4.2 Verificar Triggers de updated_at
```sql
-- Actualizar una solicitud
UPDATE vacation_requests 
SET status = 'in_progress' 
WHERE id = 'tu-request-id';

-- Verificar que updated_at cambi√≥
SELECT id, status, created_at, updated_at 
FROM vacation_requests 
WHERE id = 'tu-request-id';
```

**Verificar:**
- [ ] updated_at es diferente a created_at
- [ ] updated_at es m√°s reciente

### ‚¨ú 4.3 Probar Funci√≥n SQL
```sql
-- Probar con diferentes valores
SELECT 
  1 as years,
  get_vacation_days_by_years(1) as days
UNION ALL
SELECT 3, get_vacation_days_by_years(3)
UNION ALL
SELECT 7, get_vacation_days_by_years(7)
UNION ALL
SELECT 12, get_vacation_days_by_years(12)
UNION ALL
SELECT 25, get_vacation_days_by_years(25)
UNION ALL
SELECT 40, get_vacation_days_by_years(40);
```

**Resultado esperado:**
```
1 ‚Üí 12
3 ‚Üí 16
7 ‚Üí 22
12 ‚Üí 24
25 ‚Üí 28
40 ‚Üí 32
```

---

## ‚úÖ FASE 4 COMPLETADA
**Los datos se est√°n guardando correctamente en la base de datos.**

---

## FASE 5: PRUEBAS AVANZADAS (OPCIONAL)

### ‚¨ú 5.1 Crear Ciclo Vacacional Manual
```sql
INSERT INTO vacation_cycles (
  employee_id,
  cycle_start_date,
  cycle_end_date,
  days_earned,
  days_used,
  days_available,
  years_of_service,
  is_expired
) VALUES (
  'tu-employee-id',
  '2024-01-01',
  '2025-07-01',
  16,
  0,
  16,
  3,
  FALSE
);
```

- [ ] Insert exitoso
- [ ] Ciclo aparece en la tabla

### ‚¨ú 5.2 Verificar Constraint de Fechas
```sql
-- Esto DEBE fallar
INSERT INTO vacation_requests (
  employee_id,
  office_id,
  start_date,
  end_date,
  days_requested,
  status
) VALUES (
  'tu-employee-id',
  'tu-office-id',
  '2024-01-20',
  '2024-01-15', -- Anterior al inicio
  5,
  'pending'
);
```

**Resultado esperado:**
- [ ] Error: "new row for relation... violates check constraint"
- [ ] ‚úÖ El constraint funciona correctamente

### ‚¨ú 5.3 Verificar Expiraci√≥n Autom√°tica
```sql
-- Crear ciclo expirado
INSERT INTO vacation_cycles (
  employee_id,
  cycle_start_date,
  cycle_end_date,
  days_earned,
  days_used,
  days_available,
  years_of_service,
  is_expired
) VALUES (
  'tu-employee-id',
  '2020-01-01',
  '2021-07-01', -- Fecha en el pasado
  12,
  0,
  12,
  1,
  FALSE -- Lo ponemos FALSE para probar el trigger
);

-- Ver el resultado
SELECT * FROM vacation_cycles 
WHERE cycle_start_date = '2020-01-01';
```

**Verificar:**
- [ ] is_expired ahora es TRUE
- [ ] ‚úÖ El trigger de expiraci√≥n funciona

### ‚¨ú 5.4 Probar Vista vacation_summary
```sql
SELECT * FROM vacation_summary
ORDER BY years_of_service DESC;
```

**Verificar:**
- [ ] Muestra todos los empleados
- [ ] Calcula correctamente:
  - years_of_service
  - total_days_earned
  - total_days_used
  - total_days_available
  - active_cycles
  - pending_requests
  - approved_requests

---

## ‚úÖ FASE 5 COMPLETADA
**Todas las funcionalidades avanzadas operan correctamente.**

---

## üéâ CHECKLIST FINAL

### Resumen General
- [ ] ‚úÖ Base de datos configurada
- [ ] ‚úÖ Tablas creadas
- [ ] ‚úÖ √çndices y triggers funcionando
- [ ] ‚úÖ C√≥digo backend implementado
- [ ] ‚úÖ C√≥digo frontend implementado
- [ ] ‚úÖ UI completamente funcional
- [ ] ‚úÖ Validaciones operando
- [ ] ‚úÖ Datos guard√°ndose correctamente
- [ ] ‚úÖ Estad√≠sticas actualiz√°ndose
- [ ] ‚úÖ B√∫squeda funcionando

### Funcionalidades Core
- [ ] ‚úÖ Bot√≥n "D√≠as por Ley" con modal de tabla
- [ ] ‚úÖ Bot√≥n "Nueva Solicitud" con formulario
- [ ] ‚úÖ Dropdown de empleados con info detallada
- [ ] ‚úÖ C√°lculo autom√°tico de d√≠as
- [ ] ‚úÖ Validaci√≥n de fechas
- [ ] ‚úÖ Crear solicitud ‚Üí guarda en DB
- [ ] ‚úÖ Aprobar/Rechazar ‚Üí actualiza estado
- [ ] ‚úÖ Estad√≠sticas en tiempo real
- [ ] ‚úÖ B√∫squeda y filtrado

### Reglas de Negocio
- [ ] ‚úÖ C√°lculo correcto por a√±os (12-32 d√≠as)
- [ ] ‚úÖ Validaci√≥n de fechas (fin > inicio)
- [ ] ‚úÖ Estados de solicitud (5 estados)
- [ ] ‚úÖ Soporte para m√∫ltiples ciclos
- [ ] ‚úÖ Vigencia de 1.5 a√±os por ciclo

---

## üìä M√âTRICAS DE √âXITO

Si todos los checks est√°n marcados:

### ‚úÖ SISTEMA 100% FUNCIONAL Y LISTO PARA PRODUCCI√ìN

**Capacidades:**
- ‚úÖ Gestionar solicitudes de vacaciones
- ‚úÖ Calcular d√≠as por ley autom√°ticamente
- ‚úÖ Validar fechas y datos
- ‚úÖ Aprobar/rechazar solicitudes
- ‚úÖ Ver estad√≠sticas en tiempo real
- ‚úÖ Buscar y filtrar
- ‚úÖ Guardar todo en base de datos
- ‚úÖ Cumplir con Ley Federal del Trabajo

---

## üöÄ PR√ìXIMOS PASOS

Una vez completado este checklist:

1. **Documentar cualquier problema encontrado**
2. **Capacitar al equipo en el uso del sistema**
3. **Definir flujo de aprobaci√≥n (¬øqui√©n aprueba?)**
4. **Considerar implementar mejoras futuras:**
   - Notificaciones por email
   - Calendario visual
   - Reportes en Excel/PDF
   - Ciclos autom√°ticos en aniversarios
   - Dashboard con gr√°ficas

---

## üìû SOPORTE

**Archivos de Referencia:**
- `INSTRUCCIONES-VACACIONES.md` - Gu√≠a completa
- `RESUMEN-VACACIONES.md` - Resumen ejecutivo
- `EJEMPLOS-VACACIONES.md` - Ejemplos de uso
- `supabase-vacaciones-schema.sql` - Schema de DB

**Si algo no funciona:**
1. Revisar consola del navegador (F12)
2. Revisar logs de Supabase
3. Verificar que el SQL se ejecut√≥ completo
4. Verificar conexi√≥n a Supabase

---

**√öltima Actualizaci√≥n:** ${new Date().toLocaleDateString('es-MX', { 
  day: 'numeric', 
  month: 'long', 
  year: 'numeric' 
})}

**Estado:** üéØ LISTO PARA VERIFICACI√ìN
